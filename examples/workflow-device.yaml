# Create and delete deivce in workflow
#
tosca_definitions_version: cloudify_dsl_1_3

imports:
  - include/imports.yaml
  - include/versa-default.yaml

inputs:
    device_name:
        default: CPE2
    v_Lan_IPv4__staticaddress: 
      default: 192.168.1.1/32
    v_mpls_IPv4__staticaddress: 
      default:  192.168.2.2/32
    v_mpls-Transport-VR_IPv4__vrHopAddress: 
      default: 192.168.3.3
#
# Node templates
#
node_templates:
  #####################
  # Versa config
  #####################
  versa_configuration:
    type: cloudify.versa.nodes.versa_configuration
    properties:
      versa_config:
        username: { get_input: username }
        password: { get_input: password }
        versa_url: { get_input: versa_url}
        client_id: { get_input: client_id}
        client_secret: { get_input: client_secret}

  workflow_device:
    type: cloudify.versa.nodes.Workflow
    properties:
      versa_config: { get_property: [versa_configuration, versa_config] }
      device:
        name: { get_input: device_name }
        location: 
          country: nl
          longitude: 0
          latitude: 0
        variables: 
          "{$v_Lan_IPv4__staticaddress}": {get_input: v_Lan_IPv4__staticaddress }
          "{$v_mpls_IPv4__staticaddress}": {get_input: v_mpls_IPv4__staticaddress }
          "{$v_mpls-Transport-VR_IPv4__vrHopAddress}": {get_input: v_mpls-Transport-VR_IPv4__vrHopAddress }
    interfaces:
      cloudify.interfaces.lifecycle:
        create:
          inputs:
            device:
              name: { get_input: device_name }
        delete:
          inputs:
            device:
              name: { get_input: device_name }
